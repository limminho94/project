#include <iostream>
#include <cstring>
#include <sys/socket.h>
#include <arpa/inet.h>
#include <unistd.h>
#include <limits> // numeric_limits ВѓгВџЕВЮё ВюёьЋ┤ ВХћЖ░ђ
#include <set>
#include <string>

constexpr int BUF_SIZE = 1024;
const char *SERVER_IP = "127.0.0.1";

int main()
{
    // ьЈгьіИ ВъЁваЦ в░ЏЖИ░
    int port;
    std::cout << "ВЌ░Ж▓░ьЋа Вёюв▓ё ьЈгьіИвЦ╝ ВъЁваЦьЋўВёИВџћ: ";
    std::cin >> port;

    // ВюаьџеВё▒ Ж▓ђВѓг
    if (std::cin.fail() || port <= 0 || port > 65535)
    {
        std::cerr << "ВюаьџеьЋўВДђ ВЋіВЮђ ьЈгьіИ в▓ѕьўИВъЁвІѕвІц. 1Ж│╝ 65535 ВѓгВЮ┤ВЮў Ж░њВЮё ВъЁваЦьЋўВёИВџћ.\n";
        return 1;
    }

    // ВъЁваЦ в▓ёьЇ╝ ьЂ┤вдгВќ┤ (ьЈгьіИ ВъЁваЦ ьЏё вѓеВЮђ Ж░юьќЅ ВаюЖ▒░)
    std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n');

    // ВєїВ╝Њ ВЃЮВё▒
    int client_socket = socket(AF_INET, SOCK_STREAM, 0);
    if (client_socket == -1)
    {
        std::cerr << "ВєїВ╝Њ ВЃЮВё▒ВЌљ ВІцьїеьќѕВіхвІѕвІц.\n";
        return 1;
    }

    // Вёюв▓ё ВБ╝Вєї ВёцВаЋ
    sockaddr_in server_addr{};
    server_addr.sin_family = AF_INET;
    server_addr.sin_port = htons(port);

    if (inet_pton(AF_INET, SERVER_IP, &server_addr.sin_addr) <= 0)
    {
        std::cerr << "ВюаьџеьЋўВДђ ВЋіВЮђ ВБ╝ВєїВъЁвІѕвІц.\n";
        return 1;
    }

    // Вёюв▓ёВЌљ ВЌ░Ж▓░
    if (connect(client_socket, (sockaddr *)&server_addr, sizeof(server_addr)) < 0)
    {
        std::cerr << "Вёюв▓ё ВЌ░Ж▓░ВЌљ ВІцьїеьќѕВіхвІѕвІц.\n";
        return 1;
    }

    std::cout << "Вёюв▓ёВЌљ ВЌ░Ж▓░вљўВЌѕВіхвІѕвІц.\n";

    // ВюаьџеьЋю ВъЁваЦЖ░њВЮё вфеВЋёвєЊВЮђ set
    std::set<std::string> valid_inputs = {"вїђВцЉЖхљьєх", "Жхљьєх", "ВЄ╝ьЋЉ", "ВЎИВІЮ", "ВЮўвБї", "ВБ╝Вюа", "ьєхВІа", "1", "2", "3", "4", "5", "6"};

    std::string user_input;
    char buffer[BUF_SIZE];

    // вЕћВІюВДђ ВєАВѕўВІа вБеьћё
    while (true)
    {

        system("clear");
        // std::cout << "Вёюв▓ёВЌљ ВЌ░Ж▓░вљўВЌѕВіхвІѕвІц.\n";

        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРа░РааРАђРађРађРађРађРађРађРађРађРађРађРбИРБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РБ┐РаЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаѕРаѓРбЋРађРађРађРађРађРађРађРађРађРађРб░РБ┐РБ┐РАЪРаІРаЏРаЎРаІРаЏРаЎРаІРаЏРаЎРаІРаЏРаЎРаІРаЏРаЎРаІРаЏРаЎРаІРаЏРб╗РБ┐РБ┐РАЃРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРа░РАђРађРађРађРађРааРАЂРађРбђРа░РАђРађРађРађРађРађРа░РБ┐РБ┐РАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбИРБ┐РБ┐РаЁРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаѕРаѓРађРАђРбёРаёРађРађРаѓРаЂРађРађРађРађРађРађРаИРБ┐РБ┐РАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбИРБ┐РБ┐РаЁРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРАёРАђРађРбаРбѕРаѓРађРааРбѓРаєРбёРађРађРбђРааРАаРбаРађРбўРБ┐РБ┐РАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбИРБ┐РБ┐РаЁРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаѕРађРАбРАЂРађРађРаЂРађРаЉРбїРаѓРаљРаЂРаљРађРађРаЂРбеРБ┐РБ┐РАЄРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбИРБ┐РБ┐РаЁРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРАаРбђРаєРађРабРабРАђРАђРбђРАђРафРАљРаЁРађРађРађРађРађРађРб░РБ┐РБ┐РАЄРађРађРађРађРађРађРађРађРађРађРађРађРБђРБцРБЙРаєРађРађРађРађРбИРБ┐РБ┐РаЁРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаўРађРаЂРађРађРађРаЂРаїРаеРаѓРаїРаѓРаѕРађРабРАђРађРађРађРађРа░РБ┐РБ┐РАЄРађРађРађРађРађРађРађРађРбђРБаРа▓РБЙРБ╗РАхРБ┐РаЁРађРађРађРађРбИРБ┐РБ┐РаЁРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбёРаЁРаЂРађРађРбђРаєРађРађРађРађРаѕРађРађРађРађРбўРБ┐РБ┐РАЄРађРађРађРађРађРбђРБцРБХРА╗РБ┐РађРађРбЎРАЙРБ»РАЃРађРађРађРађРбИРБ┐РБ┐РаЁРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбљРаЁРађРађРађРађРађРађРађРађРађРбеРБ┐Ра┐РаЃРађРађРБаРБ┤РАЌРаЎРа│РБйРБЮРБ┐РађРађРаљРБ┐РБ╗РаєРађРађРађРађРбИРБ┐РБ┐РаЁРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаЂРбђРАцРбъРБЪРб┐РБ«РБЈРађРађРБИРАиРБ┐РађРађРаеРБ┐РБйРАЃРађРађРађРађРбИРБ┐РБ┐РаЁРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбљРБЙРб┐РАѓРађРаЅРБ┐Рб«РАЌРађРађРБИРБ»РБ┐РађРађРбљРА┐РБЙРаЁРађРБђРБђРБђРБИРБ┐РБ┐РаЁРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаљРБ┐РБ╗РаЁРађРађРБ┐РбйРБЈРађРађРБИРАиРБ╗РађРађРбљРБ┐РБйРАЃРађРб╝РБ┐РБ┐РБ┐РБ┐РБ┐РаЁРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаѕРаЂРаЅРађРађРађРаЅРаѕРаЂРађРађРаѕРаЅРаЅРађРађРађРаЂРаѕРађРађРаѕРаЅРаЅРаЅРаЅРаЅРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "\n";
        std::cout << "\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРааРБцРБЙРБЙРБХРБцРб┤РБиРАХРБ║РБХРАєРађРађРађРађРађРб░РБиРБХРађРађРб░РБиРБЙРађРађРађРађРађРаљРБиРБЙРБХРБиРБЙРБХРБиРБЙРБХРаєРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаѕРбЏРБЏРБ╗РБЏРБЏРб╣РБ┐РБ┐РБЙРБ┐РАЄРађРађРађРађРбђРБ╝РБ┐РБ┐РБЄРађРбИРБ┐РБ┐РБ┐РАЄРађРађРађРбљРБиРБХРБХРБХРБХРБХРБЙРБ┐РБ┐РАЃРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРБ┐РБ┐РБ»РБ┐РБ┐РбИРБ┐РБЈРб┐РБ┐РАЄРађРађРађРбИРБ┐Ра┐РаІРа╗Рб┐РБ┐РбјРБ┐РБ┐РађРађРађРађРађРађРб┐Рб┐РбиРБиРБиРБиРБХРБХРбХРаєРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРбЕРБйРБГРБГРБГРБгРБ»РББРБйРБЮРАёРађРађРађРаеРБХРБХРБХРБХРБХРБХРБХРБиРБиРађРађРађРађРађРб┐Ра┐РАиРа┐Ра┐Рб┐Ра┐РАХРАиРб┐Ра┐РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаўРаЏРаЏРаЏРаЏРаЏРаЏРаЏРБ┐РБ┐РАЄРађРађРађРбљРБиРБиРАиРаиРаиРаиРаЙРа┐Рб┐РаЂРађРађРађРађРааРБ┐РБЙРБдРБёРБцРБцРБаРБцРБёРАёРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n";
        std::cout << "РађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРаѕРаЪРа╗РаЂРађРађРађРађРаЏРаЏРаЪРаЪРа┐Ра╗РаЪРа┐Ра╗РаЂРађРађРађРађРађРа╗РаЏРаЪРаЏРаЏРаЏРаЏРаЏРаЏРаѓРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађРађ\n\n";

        // std::cin.get()ВЮё ВѓгВџЕьЋўВЌг ВЋёвг┤ ьѓцвѓў ВъЁваЦ в░ЏЖИ░
        std::cout << "ьЋхВѓ┤вАа В╣┤вЊю ВХћВ▓ю Вёюв╣ёВіцВЌљ ВўцВІаЖ▒И ьЎўВўЂьЋЕвІѕвІц.\n";
        std::cout << "Ж│ёВєЇьЋўвацвЕ┤ ВЋёвг┤ ьѓцвѓў вѕёвЦ┤ВёИВџћ.";

        std::cin.get(); // ВѓгВџЕВъљвАювХђьё░ ВЋёвг┤ ьѓцвѓў ВъЁваЦв░ЏВЮї
        system("clear");
        
        std::cout << "--------------------------------------------------------\t";
        std::cout << "--------------------------------------------------------\n";
        std::cout << "|                 вДъВХц ьўюьЃЮВю╝вАю ВДЂВаЉ В░ЙЖИ░               |\t";
        std::cout << "|                    ьЁїВіцьіИвАю ВХћВ▓юв░ЏЖИ░                  |\n";

        std::cout << "|                                                       |\t";
        std::cout << "|                                                       |\n";
        std::cout << "|                                                       |\t";
        std::cout << "|                                                       |\n";
        std::cout << "|                  6Ж░ђВДђ ВЃЂВёИьўюьЃЮВю╝вАю                   |\t";
        std::cout << "|                  Вєїв╣ёВё▒ьќЦВю╝вАю ВЋїВЋёв│┤віћ                |\n";
        std::cout << "|                      1. В╣┤вЊюЖ▓ђВЃЅ                      |\t";
        std::cout << "|                   2. В╣┤вЊюВХћВ▓юьЁїВіцьіИ                   |\n";
        std::cout << "--------------------------------------------------------\t";
        std::cout << "--------------------------------------------------------\n";



        // ВюаьџеьЋю ВъЁваЦЖ░њВЮё вфеВЋёвєЊВЮђ set
        std::set<std::string> valid_inputs = {"вїђВцЉЖхљьєх", "Жхљьєх", "ВЄ╝ьЋЉ", "ВЎИВІЮ", "ВЮўвБї", "ВБ╝Вюа", "ьєхВІа",
                                              "1", "2", "3", "4", "5", "6"};
        bool inputMode = true;
        
        
        while(inputMode)
        {
            std::cout << "ВЏљьЋўвіћ ьЋГвфЕВЮё ВъЁваЦьЋўВёИВџћ (1.В╣┤вЊюЖ▓ђВЃЅ 2.В╣┤вЊюВХћВ▓юьЁїВіцьіИ): ";
            std::getline(std::cin, user_input); // ВѓгВџЕВъљ ВъЁваЦ в░ЏЖИ░
            
            if(user_input != "1" && user_input != "2")
            {
                std::cout << "вІцВІю ВъЁваЦьЋ┤ВБ╝ВёИВџћ\n";
                continue;
            }
            else if(user_input == "1")
            {
                system("clear");
                std::cout << "1в▓ѕ ВХюваЦ\n";
                break;
            }
            else if(user_input == "2")
            {
                system("clear");
                std::cout << "2в▓ѕ ВХюваЦ\n";
                break;
            }

        }

        std::cout << "----------------------------------\t";
        std::cout << "----------------------------------\t";
        std::cout << "----------------------------------\n";

        std::cout << "|           1.вїђВцЉЖхљьєх            |\t";
        std::cout << "|           2. ВЄ╝ьЋЉ              |\t";
        std::cout << "|           3. ВЎИВІЮ              |\n";

        std::cout << "|               ­Ъџї                |\t";
        std::cout << "|               ­ЪЏЇ№ИЈ                |\t";
        std::cout << "|               ­ЪЇй№ИЈ                |\n";

        std::cout << "----------------------------------\t";
        std::cout << "----------------------------------\t";
        std::cout << "----------------------------------\n\n";

        // вЉљ в▓ѕВДИ Вцё (4, 5, 6)
        std::cout << "----------------------------------\t";
        std::cout << "----------------------------------\t";
        std::cout << "----------------------------------\n";

        std::cout << "|           4. ВЮўвБї              |\t";
        std::cout << "|           5. ВБ╝Вюа              |\t";
        std::cout << "|           6. ьєхВІа              |\n";

        std::cout << "|               ­ЪЈЦ               |\t";
        std::cout << "|               РЏй               |\t";
        std::cout << "|               ­ЪЊъ               |\n";

        std::cout << "----------------------------------\t";
        std::cout << "----------------------------------\t";
        std::cout << "----------------------------------\n";

        // ВѓгВџЕВъљ ВъЁваЦ в░ўв│х вБеьћё
        while (inputMode)
        {
            std::string user_input;
            std::string result;
            char buffer[BUF_SIZE];

            std::cout << "ВЏљьЋўвіћ ьЋГвфЕВЮё ВъЁваЦьЋўВёИВџћ (вїђВцЉЖхљьєх, Жхљьєх, ВЄ╝ьЋЉ, ВЎИВІЮ, ВЮўвБї, ВБ╝Вюа, ьєхВІа, вўљвіћ 1ВЌљВёю 6Ж╣їВДђВЮў ВѕФВъљ): ";
            std::getline(std::cin, user_input); // ВѓгВџЕВъљ ВъЁваЦ в░ЏЖИ░

            // ВъЁваЦЖ░њВЮ┤ ВюаьџеьЋюВДђ ьЎЋВЮИ
            if (valid_inputs.find(user_input) != valid_inputs.end())
            {
                // ВюаьџеьЋю ВъЁваЦВЮ┤вЕ┤ вїђВЮЉьЋўвіћ Ж▓░Ж│╝вЦ╝ ВёцВаЋьЋўЖ│а в░ўв│х ВбЁвБї
                if (user_input == "вїђВцЉЖхљьєх" || user_input == "Жхљьєх" || user_input == "1")
                {
                    result = "вїђВцЉЖхљьєх";
                }
                else if (user_input == "2" || user_input == "ВЄ╝ьЋЉ")
                {
                    result = "ВЄ╝ьЋЉ";
                }
                else if (user_input == "3" || user_input == "ВЎИВІЮ")
                {
                    result = "ВЎИВІЮ";
                }
                else if (user_input == "4" || user_input == "ВЮўвБї")
                {
                    result = "ВЮўвБї";
                }
                else if (user_input == "5" || user_input == "ВБ╝Вюа")
                {
                    result = "ВБ╝Вюа";
                }
                else if (user_input == "6" || user_input == "ьєхВІа")
                {
                    result = "ьєхВІа";
                }   

                system("clear");
                // TOP3 ВХюваЦ
                // "query:" ВаЉвЉљВѓг ВХћЖ░ђ
                std::string modified_message = "query:SELECT rb.card_name AS В╣┤вЊювфЁ, rb.type AS ВюаьўЋ, rb.corp_name AS В╣┤вЊюВѓг, c.annual AS ВЌ░ьџїв╣ё, c.month AS ВаёВЏћВІцВаЂ, CASE WHEN c.bene1_type = '" + result + "' THEN c.bene1 WHEN c.bene2_type = '" + result + "' THEN c.bene2 ELSE 'ьЋ┤вІ╣ ьўюьЃЮ ВЌєВЮї' END AS ьўюьЃЮ FROM card_project.Rank_Benefit rb JOIN card_project.Card c ON rb.card_name = c.name WHERE rb.type = '" + result + "'";

                send(client_socket, modified_message.c_str(), modified_message.length(), 0);
                std::cout << std::endl;

                ssize_t bytes_received = recv(client_socket, buffer, 10000, 0);
                if (bytes_received <= 0)
                {
                    std::cerr << "Вёюв▓ёЖ░ђ ВЌ░Ж▓░ВЮё вЂіВЌѕЖ▒░вѓў ВўцвЦўЖ░ђ в░юВЃЮьќѕВіхвІѕвІц.\n";
                    break;
                }

                buffer[bytes_received] = '\0';
                std::cout << buffer << std::endl;

                std::cout << "===============================================================================";
                // "query:" ВаЉвЉљВѓг ВХћЖ░ђ
                modified_message = "query:SELECT name AS 'В╣┤вЊювфЁ', corp_name AS 'В╣┤вЊюВѓг', annual AS 'ВЌ░ьџїв╣ё', month AS 'ВаёВЏћВІцВаЂ', bene1 AS 'ьўюьЃЮ1', bene2 AS 'ьўюьЃЮ2', bene1_type AS 'ьўюьЃЮьЃђВъЁ1', bene2_type AS 'ьўюьЃЮьЃђВъЁ2' FROM card_project.Card WHERE name NOT IN(SELECT card_name FROM card_project.Rank_Benefit WHERE type = '" + result + "') AND (bene1_type ='" + result + "' OR bene2_type ='" + result + "')";

                send(client_socket, modified_message.c_str(), modified_message.length(), 0);
                std::cout << std::endl;

                bytes_received = recv(client_socket, buffer, 10000, 0);
                if (bytes_received <= 0)
                {
                    std::cerr << "Вёюв▓ёЖ░ђ ВЌ░Ж▓░ВЮё вЂіВЌѕЖ▒░вѓў ВўцвЦўЖ░ђ в░юВЃЮьќѕВіхвІѕвІц.\n";
                    break;
                }

                buffer[bytes_received] = '\0';
                system("clear");
                std::cout << buffer << std::endl;

                // вІцВІю ВІюВъЉ вўљвіћ ВбЁвБї ВЌгвХђ ьЎЋВЮИ
                std::cout << "вІцВІю ВІюВъЉьЋўвацвЕ┤ EnterвЦ╝, ВбЁвБїьЋўвацвЕ┤ 'exit'вЦ╝ ВъЁваЦьЋўВёИВџћ: ";
                std::getline(std::cin, user_input);

                if (user_input == "exit")
                {
                    break; // ьћёвАюЖиИвъе ВбЁвБї
                }

                inputMode = false;
                break; // в░ўв│х ВбЁвБї
            }
            else
            {
                // ВюаьџеьЋўВДђ ВЋіВЮђ ВъЁваЦВЮ┤вЕ┤ вІцВІю ВџћВ▓Г
                std::cout << "Въўвф╗вљю ВъЁваЦВъЁвІѕвІц. вІцВІю ВІювЈёьЋ┤ВБ╝ВёИВџћ." << std::endl;
            }
        }
        // ВЮ╝в░ў вЕћВІюВДђ ВаёВєА вфевЊювАю ВаёьЎў
        // ВЮ╝в░ў вЕћВІюВДђ ВаёВєА вфевЊювАю ВаёьЎў
        while (!inputMode)
        {
            system("clear");
            std::cout << "Вёюв▓ёвАю в│┤вѓ╝ вЕћВІюВДђвЦ╝ ВъЁваЦьЋўВёИВџћ ('exit'ВЮё ВъЁваЦьЋўвЕ┤ ВбЁвБїьЋЕвІѕвІц): ";
            std::getline(std::cin, user_input);

            // в╣ѕ ВъЁваЦВЌљ вїђьЋю В▓ўвдг: ВѓгВџЕВъљЖ░ђ ВЌћьё░вДї ВъЁваЦьЋўвЕ┤ вІцВІю ВъЁваЦ ВџћЖхг
            if (user_input.empty())
            {
                std::cout << "ВъЁваЦ Ж░њВЮ┤ в╣ёВќ┤ ВъѕВіхвІѕвІц. вІцВІю ВъЁваЦьЋ┤ВБ╝ВёИВџћ.\n";
                continue; // вБеьћёВЮў В▓ўВЮїВю╝вАю вЈїВЋёЖ░ђ вІцВІю ВъЁваЦ в░ЏВЮї
            }

            // 'exit' ВъЁваЦ ВІю ВЮ╝в░ў вЕћВІюВДђ вфевЊю ВбЁвБї
            if (user_input == "exit")
            {
                break; // ВЮ╝в░ў вЕћВІюВДђ вфевЊю ВбЁвБї
            }

            // ВЮ╝в░ў вЕћВІюВДђ ВаёВєА
            if (send(client_socket, user_input.c_str(), user_input.length(), 0) == -1)
            {
                std::cerr << "вЕћВІюВДђ ВаёВєАВЌљ ВІцьїеьќѕВіхвІѕвІц.\n";
                return 1;
            }
            std::cout << "вЕћВІюВДђвЦ╝ ВаёВєАьќѕВіхвІѕвІц: " << user_input << std::endl;

            // Вёюв▓ёвАювХђьё░ВЮў ВЮЉвІх ВѕўВІа
            ssize_t bytes_received = recv(client_socket, buffer, BUF_SIZE - 1, 0);
            if (bytes_received <= 0)
            {
                std::cerr << "Вёюв▓ёЖ░ђ ВЌ░Ж▓░ВЮё вЂіВЌѕЖ▒░вѓў ВўцвЦўЖ░ђ в░юВЃЮьќѕВіхвІѕвІц.\n";
                return 1;
            }

            buffer[bytes_received] = '\0'; // в░ЏВЮђ вЇ░ВЮ┤ьё░вЦ╝ вгИВъљВЌ┤вАю в│ђьЎў
            std::cout << "Вёюв▓ёвАювХђьё░: " << buffer << std::endl;
        }
        break;
    }

    // ьЂ┤вЮ╝ВЮ┤ВќИьіИ ВєїВ╝Њ ВбЁвБї
    close(client_socket);
    return 0;
}
